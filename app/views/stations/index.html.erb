

<% unless is_home? %>
<h1>Wind stations</h1>
<% end %>

<% unless @stations.empty?  %>
<div class="stations_map small-12 large-12 columns" id="map_canvas" data-lat="<%= @stations.first.lat %>" data-lon="<%= @stations.first.lon %>">
  <% @stations.each do |station| %>
  <div class="marker hidden" data-lat="<%= station.lat %>" data-lon="<%= station.lon %>">
    <h3 class="title"><%= station.name %></h3>
  </div>
  <% end %>
</div>
<% end %>

<table class="stations large-8 columns">
  <thead>
    <tr>
      <th>Name</th>
      <th>Wind speed</th>
      <th>Direction</th>
      <% if can? :manage, Station %>
      <th>Actions</th>
      <% end %>
      <th>Status</th>
    </tr>
  </thead>
  <tbody>
    <% @stations.each do |station| %>
      <tr class="station" id="station-<%= station.id %>">
        <td class="name"><%= link_to station.name, station %></td>
        <td class="speed">
          <% unless station.measures.empty? %>
            <%= station.current_measure.speed %> (<%=  station.current_measure.min_wind_speed %> - <%=  station.current_measure.max_wind_speed %>)
          <% end %>
        </td>
        <td class="direction">
          <% unless station.measures.empty? %>
              <%=  station.current_measure.direction %> (<%=  station.current_measure.compass_point %>)
          <% end %>
        </td>

        <% if can? :manage, Station %>
        <td class="admin-only">
          <ul class="actions button-group tiny">
            <li><%= link_to 'Edit', edit_station_path(station), class: 'button tiny' %></li>
            <li><%= link_to 'Delete', station, method: :delete, data: { confirm: 'Are you sure?' }, class: 'button alert tiny' %></li>
          </ul>
        </td>
        <% end %>
        <td>
            <% unless station.down? %>
            <span class="label success">OK</span>
            <% else %>
            <span class="label alert">DOWN</span>
            <% end %>
        </td>
      </tr>
    <% end %>
    <% if can? :create, Station && params[:controller] == 'stations' %>
      <tr class="station">
        <td><%= link_to 'New Station', new_station_path %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<% unless is_home? %>
<ul class="breadcrumbs">
  <li class="root"><a href="<%= root_path %>">Home</a></li>
  <li class="current"><a href="<%= stations_path %>">Stations</a></li>
</ul>
<% end %>